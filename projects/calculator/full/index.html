<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="theme-color" content="#d97706"/><title>Calculator (Full)</title>
<style>
:root{--bg0:#fff7e6;--bg1:#fff1d6;--card:rgba(255,255,255,.9);--ink:#1f2937;--muted:#6b7280;--brand:#d97706;--border:rgba(31,41,55,.14);--shadow:0 12px 30px rgba(17,24,39,.1);--ring:0 0 0 4px rgba(217,119,6,.18)}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:linear-gradient(180deg,var(--bg0),var(--bg1));color:var(--ink);padding:16px}
.wrap{max-width:900px;margin:0 auto}
.card{background:var(--card);border:1px solid var(--border);border-radius:24px;box-shadow:var(--shadow);padding:14px}
h1{margin:0 0 6px} .sub{margin:0 0 12px;color:var(--muted);font-weight:650}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.screen{border:1px solid var(--border);border-radius:18px;background:rgba(255,255,255,.75);padding:12px}
.expr{font-weight:900;font-size:18px}
.hint{margin-top:6px;color:var(--muted);font-weight:750;font-size:13px}
.keys{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px}
button{border:1px solid var(--border);background:white;border-radius:16px;padding:12px 10px;font-weight:950;cursor:pointer}
button.op{background:linear-gradient(135deg, rgba(217,119,6,.12), rgba(245,158,11,.16));border-color:rgba(217,119,6,.35)}
button:focus-visible{outline:none;box-shadow:var(--shadow),var(--ring)}
.hist{border:1px solid var(--border);border-radius:18px;background:rgba(255,255,255,.75);padding:10px;min-height:220px}
.item{display:flex;justify-content:space-between;gap:10px;padding:6px 0;border-bottom:1px dashed rgba(31,41,55,.12);font-weight:850;color:var(--muted)}
.item b{color:var(--ink)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(217,119,6,.25);background:rgba(255,255,255,.7);font-weight:900;color:#92400e}
.btn{border:1px solid var(--border);background:white;border-radius:14px;padding:10px 12px;font-weight:950;cursor:pointer}
</style></head><body>
<div class="wrap"><div class="card">
<div class="row">
  <div>
    <div class="pill">üèÜ Full Edition</div>
    <h1>üßÆ Calculator + History</h1>
    <p class="sub">Keyboard support + persistent history (localStorage).</p>
  </div>
  <div class="row" style="justify-content:flex-end">
    <span class="pill">History: <span id="hCount">0</span></span>
    <button class="btn" id="clearHist">Clear History</button>
  </div>
</div>
<div class="grid">
  <div>
    <div class="screen">
      <div class="expr" id="screen">0</div>
      <div class="hint">Keys: numbers, + - * /, parentheses, Enter (=), Backspace, Esc (clear)</div>
    </div>
    <div class="keys" id="keys"></div>
  </div>
  <div>
    <div class="screen" style="padding:10px"><b style="color:var(--muted)">History</b></div>
    <div class="hist" id="hist"></div>
  </div>
</div>
</div></div>
<script>
const KEY="pp_calc_hist_v1";
const screen=document.getElementById("screen");
const hist=document.getElementById("hist");
const keys=document.getElementById("keys");
const hCount=document.getElementById("hCount");
const layout=["7","8","9","/","4","5","6","*","1","2","3","-","0",".","C","+","‚å´","(",")","="];
let expr="";
let history=loadHist();

function render(){
  screen.textContent=expr||"0";
  hCount.textContent=history.length;
  hist.innerHTML=history.map(item=>`
    <div class="item" title="Click to reuse">
      <span data-act="reuse" data-expr="${escAttr(item.expr)}">${esc(item.expr)}</span>
      <b>${esc(String(item.out))}</b>
    </div>`).join("") || `<div class="item"><span>No history yet</span><b>‚Äî</b></div>`;
}
function loadHist(){
  try{const raw=localStorage.getItem(KEY);const arr=raw?JSON.parse(raw):[];return Array.isArray(arr)?arr.slice(0,50):[];}
  catch{return []}
}
function saveHist(){localStorage.setItem(KEY, JSON.stringify(history.slice(0,50)));}
function safeEval(s){
  if(!/^[0-9+\-*/().\s]+$/.test(s)) throw new Error("Invalid chars");
  if(/[*\/]{2,}/.test(s)) throw new Error("Bad operator");
  return Function("return ("+s+")")();
}
function calc(){
  if(!expr.trim()) return;
  try{
    const out=safeEval(expr);
    history.unshift({expr,out,ts:Date.now()});
    history=history.slice(0,50); saveHist();
    expr=String(out);
  }catch{
    history.unshift({expr,out:"Error",ts:Date.now()});
    history=history.slice(0,50); saveHist();
    expr="";
  }
  render();
}
function press(k){
  if(k==="C"){expr="";return render();}
  if(k==="‚å´"){expr=expr.slice(0,-1);return render();}
  if(k==="="){return calc();}
  expr+=k; render();
}
keys.innerHTML=layout.map(k=>{
  const op=["+","-","*","/","="].includes(k);
  return `<button class="${op?'op':''}" data-k="${k}">${k}</button>`;
}).join("");
keys.addEventListener("click",(e)=>{
  const b=e.target.closest("button[data-k]"); if(!b) return;
  press(b.getAttribute("data-k"));
});
document.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){e.preventDefault();return calc();}
  if(e.key==="Backspace"){return press("‚å´");}
  if(e.key==="Escape"){return press("C");}
  const k=e.key;
  if(/^[0-9]$/.test(k)) return press(k);
  if(["+","-","*","/","(",")","."].includes(k)) return press(k);
});
document.getElementById("clearHist").addEventListener("click",()=>{
  if(!confirm("Clear history?")) return;
  history=[]; saveHist(); render();
});
hist.addEventListener("click",(e)=>{
  const s=e.target.closest('[data-act="reuse"]'); if(!s) return;
  expr=s.getAttribute("data-expr")||""; render();
});
function esc(s){return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");}
function escAttr(s){return esc(s).replaceAll("`","&#096;");}
render();
</script></body></html>